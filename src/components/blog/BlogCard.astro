---
/**
 * BlogCard.astro
 *
 * Card component for blog post previews
 * Used in blog index and related posts sections
 */
import type { Language } from '../../i18n';
import { getBlogImageUrl } from '../../lib/storage';

interface Props {
  title: string;
  description: string;
  slug: string;
  image?: string;
  imageAlt?: string;
  category?: string;
  publishDate: Date;
  readingTime?: number;
  lang: Language;
}

const {
  title,
  description,
  slug,
  image,
  imageAlt,
  category,
  publishDate,
  readingTime,
  lang,
} = Astro.props;

// Category labels and colors
const categoryConfig: Record<string, { label: Record<Language, string>; emoji: string }> = {
  guides: {
    label: { fr: 'Guide', 'fr-FR': 'Guide', es: 'GuÃ­a', en: 'Guide' },
    emoji: 'ðŸ“š',
  },
  comparatifs: {
    label: { fr: 'Comparatif', 'fr-FR': 'Comparatif', es: 'Comparativa', en: 'Comparison' },
    emoji: 'âš–ï¸',
  },
  astuces: {
    label: { fr: 'Astuces', 'fr-FR': 'Astuces', es: 'Consejos', en: 'Tips' },
    emoji: 'ðŸ’¡',
  },
  recettes: {
    label: { fr: 'Recettes', 'fr-FR': 'Recettes', es: 'Recetas', en: 'Recipes' },
    emoji: 'ðŸ½ï¸',
  },
  temoignages: {
    label: { fr: 'TÃ©moignage', 'fr-FR': 'TÃ©moignage', es: 'Testimonio', en: 'Testimonial' },
    emoji: 'ðŸ’¬',
  },
};

const categoryInfo = category ? categoryConfig[category] : null;
const categoryLabel = categoryInfo?.label[lang] || category;
const categoryEmoji = categoryInfo?.emoji || 'ðŸ“';

// Format date
const formattedDate = publishDate.toLocaleDateString(
  lang === 'en' ? 'en-US' : lang === 'es' ? 'es-ES' : 'fr-FR',
  { year: 'numeric', month: 'short', day: 'numeric' }
);

// Build URL
const getBlogUrl = () => {
  const basePath = lang === 'fr' ? '/blog/' : `/${lang === 'fr-FR' ? 'fr' : lang}/blog/`;
  return `${basePath}${slug}/`;
};

// Reading time text
const readingTimeText = {
  fr: 'min de lecture',
  'fr-FR': 'min de lecture',
  es: 'min de lectura',
  en: 'min read',
};

// Resolve image URL (handle both relative paths and full URLs)
function resolveImageUrl(imagePath: string | undefined): string | undefined {
  if (!imagePath) return undefined;
  if (imagePath.startsWith('http') || imagePath.startsWith('/')) return imagePath;
  return getBlogImageUrl(imagePath);
}

const resolvedImage = resolveImageUrl(image);
---

<article class="blog-card group">
  <a href={getBlogUrl()} class="block">
    <!-- Image -->
    {resolvedImage ? (
      <img
        src={resolvedImage}
        alt={imageAlt || title}
        class="blog-card-image"
        loading="lazy"
      />
    ) : (
      <div class="blog-card-image flex items-center justify-center" style="background: var(--blog-accent-light);">
        <span class="text-6xl">{categoryEmoji}</span>
      </div>
    )}

    <!-- Content -->
    <div class="blog-card-content">
      <!-- Category badge -->
      {category && (
        <span class="blog-card-category">
          {categoryEmoji} {categoryLabel}
        </span>
      )}

      <!-- Title -->
      <h3 class="blog-card-title group-hover:text-[var(--blog-accent)] transition-colors">
        {title}
      </h3>

      <!-- Excerpt -->
      <p class="blog-card-excerpt">
        {description}
      </p>

    </div>
  </a>
</article>
