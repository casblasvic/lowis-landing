---
import { type Language, languages, getPathWithLang, defaultLang } from '../i18n';
import Logo from './ui/Logo.astro';

interface Props {
  t: {
    nav: {
      features: string;
      howItWorks: string;
      pricing: string;
      faq: string;
      cta: string;
    };
  };
  lang: Language;
}

const { t, lang } = Astro.props;

const navLinks = [
  { href: '#features', label: t.nav.features },
  { href: '#how-it-works', label: t.nav.howItWorks },
  { href: '#pricing', label: t.nav.pricing },
  { href: '#faq', label: t.nav.faq },
];

// Language options for switcher
const langOptions = Object.entries(languages).map(([code, name]) => ({
  code,
  name,
  href: getPathWithLang('/', code as Language),
  active: code === lang,
}));
---

<header class="fixed top-0 left-0 right-0 z-50 glass border-b border-dark-border">
  <nav class="section-container py-4">
    <div class="flex items-center justify-between">
      <!-- Logo -->
      <a href={getPathWithLang('/', lang)} class="flex items-center gap-2">
        <Logo class="h-10 w-10" />
        <span class="font-bold text-xl gradient-text">LOWIS</span>
      </a>

      <!-- Desktop Navigation -->
      <div class="hidden md:flex items-center gap-8">
        {navLinks.map((link) => (
          <a
            href={link.href}
            class="text-text-secondary hover:text-white transition-colors duration-200 text-sm font-medium"
          >
            {link.label}
          </a>
        ))}
      </div>

      <!-- Right side: Language + CTA -->
      <div class="flex items-center gap-4">
        <!-- Language Switcher -->
        <div class="relative group">
          <button
            class="flex items-center gap-1 text-text-secondary hover:text-white transition-colors px-2 py-1 rounded-lg"
            aria-label="Change language"
          >
            <span class="text-sm uppercase font-medium">{lang}</span>
            <span class="material-symbols-outlined text-lg">expand_more</span>
          </button>

          <!-- Dropdown -->
          <div class="absolute right-0 top-full mt-2 py-2 bg-dark-surface border border-dark-border rounded-xl shadow-xl opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 min-w-[120px]">
            {langOptions.map((option) => (
              <a
                href={option.href}
                class:list={[
                  'block px-4 py-2 text-sm transition-colors',
                  option.active
                    ? 'text-primary-orange bg-dark-hover'
                    : 'text-text-secondary hover:text-white hover:bg-dark-hover',
                ]}
              >
                {option.name}
              </a>
            ))}
          </div>
        </div>

        <!-- CTA Button -->
        <a href="#pricing" class="btn-primary hidden sm:inline-flex text-sm px-4 py-2">
          {t.nav.cta}
        </a>

        <!-- Mobile menu button -->
        <button
          id="mobile-menu-btn"
          class="md:hidden p-2 text-text-secondary hover:text-white transition-colors"
          aria-label="Toggle menu"
        >
          <span class="material-symbols-outlined text-2xl" id="menu-icon">menu</span>
        </button>
      </div>
    </div>

    <!-- Mobile Navigation -->
    <div id="mobile-menu" class="hidden md:hidden mt-4 pt-4 border-t border-dark-border">
      <div class="flex flex-col gap-4">
        {navLinks.map((link) => (
          <a
            href={link.href}
            class="text-text-secondary hover:text-white transition-colors py-2 text-lg"
          >
            {link.label}
          </a>
        ))}
        <a href="#pricing" class="btn-primary text-center mt-2">
          {t.nav.cta}
        </a>
      </div>
    </div>
  </nav>
</header>

<script>
  const menuBtn = document.getElementById('mobile-menu-btn');
  const mobileMenu = document.getElementById('mobile-menu');
  const menuIcon = document.getElementById('menu-icon');

  if (menuBtn && mobileMenu && menuIcon) {
    menuBtn.addEventListener('click', () => {
      const isHidden = mobileMenu.classList.contains('hidden');
      mobileMenu.classList.toggle('hidden');
      menuIcon.textContent = isHidden ? 'close' : 'menu';
    });

    // Close menu when clicking a link
    mobileMenu.querySelectorAll('a').forEach((link) => {
      link.addEventListener('click', () => {
        mobileMenu.classList.add('hidden');
        menuIcon.textContent = 'menu';
      });
    });
  }
</script>
